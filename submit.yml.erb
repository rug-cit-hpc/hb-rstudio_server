<%-
    cores = num_cores.to_i

    time_match = /((\d*)-)?(\d*):(\d*):(\d*)/.match(walltime)
    days = time_match[2].to_i
    hours = time_match[3].to_i
    minutes = time_match[4].to_i
    seconds = time_match[5].to_i

    time = 86400 * days + 3600 * hours + 60 * minutes + seconds

    if node_type == "regular" 
        if time <= 1800
            partition = 'short'
        elsif time > 1800
            partition = 'regular'
        end
    elsif node_type == 'himem'
        partition = 'himem'
    elsif node_type == 'gpuk40' || node_type == 'gpuv100'
        gpu_type_match = /^gpu(.*)/.match(node_type)
        gpu_type = gpu_type_match[1]
        if time <= 7200
            partition = 'gpushort'
        elsif time > 7200
            puts time
            partition = 'gpu'
        end
    end
-%>
---
batch_connect:
  template: "basic"
script:
  queue_name: <%= partition %>
  native:
    <%- if partition == 'gpu' or partition == 'gpushort' -%>
    - '--gres=gpu:<%= gpu_type %>:1'
    <%- end -%>
    <%- if pg_email_on_started and not pg_email_user.blank? -%>
    - "--mail-type=BEGIN"
    - "--mail-user=<%= pg_email_user %>"
    <%- end -%>
    - "-c"
    - "<%= num_cores.blank? ? 1 : num_cores.to_i %>"
    - "--mem"
    - "<%= memory.blank? ? 2000 : memory.to_i * 1000 %>"
    - "-t"
    - "<%= walltime %>"
